@model Sciendo.Music.DataProviders.Models.Indexing.IndexModel
@{
    ViewBag.Title = "Index & Acquire";
}
@section styles
{
    @Styles.Render("~/Content/autocomplete")
    @Styles.Render("~/Content/indexing")
}
<h3>Actions</h3>
<div>
    <label for="musicIndexFromPath">From music path:</label>
    <input 
        data-bind="value:musicFromPath" 
        type="search" 
        name="musicIndexFromPath"
        class="longfield"
        data-autocomplete="@Url.Action("GetMusicAutocomplete", "Home")" />
    <button data-bind="click:indexMusic">Index</button>
    <input type="checkbox" data-bind="checked:retryExisting"/>Retry existing <button data-bind="click:acquireLyrics">Acquire Lyrics</button>
</div>
<div>
    <label for="lyricsIndexFromPath">Index lyrics from path:</label>
    <input data-bind="value:lyricsFromPath" type="search" name="lyricsIndexFromPath" data-autocomplete="@Url.Action("GetLyricsAutocomplete", "Home")" />
    <button data-bind="click:indexLyrics">Go</button>
</div>
<div data-bind="if:indexedOccured">
    <label id="resultsIndexed" data-bind="text:indexingResultMessage"></label>
    <div class="validation-summary-errors" data-bind="if:indexedWithError"></div>
    <label id="errorIndexed" data-bind="text:indexingError"></label>
</div>
<h3>Monitoring</h3>
<a href="#" data-bind="click:toggle, text:monitoringActionName"></a>
<!--ko if: hasSubscription-->
<div class="container" data-bind="foreach: monitoringMessages">
    <span class="messages identifier">
        <span data-bind="if:$data.StatusOk"><img src="~/Content/indexing/images/Done.png" alt="Done" width="16" height="16" /></span>
        <span data-bind="if:$data.StatusOk==false"><img src="~/Content/indexing/images/Error.png" alt="Error" width="16" height="16" /></span>
        <label>Message Id:</label>
        <label data-bind="text: $data.Id"></label>
        <label>From:</label>
        <label data-bind="text: $data.CreateDateTime"></label>
        <a href="#" data-bind="click:$data.revealDetails,text:$data.DetailsActionName"></a>
    </span>
    <span class="messages details">
        <label data-bind="text: $data.Package, visible:$data.DetailsVisible"></label>
    </span>
</div>
<!-- /ko-->
@section scripts
{
    @Scripts.Render("~/bundles/signalR")
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/bundles/index")
    <script>
        // Initiate the Knockout bindings
        var vm = new indexViewModel("@Server.HtmlEncode(@Model.SourceFolders.Music)", "@Server.HtmlEncode(@Model.SourceFolders.Lyrics)");
        ko.applyBindings(vm);
        $.connection.hub.start().done(function () {
            vm.toggle(true);
        });

    </script>
}